import Head from 'next/head'
import Hero from '../components/hero'
import Menu from '../components/menu'
import axios from 'axios'
import styles from '../styles/Home.module.css'
import AdminNav from '../components/admin/admin-nav'
import CurrentOrders from '../components/admin/current-orders'

export default function Home({ sections, itemsList, admin, orders }) {

  const sectionsList = sections.filter((section) => section.title !== "Extra Toppings")

  return (
    <div className={styles.container}>
      <Head>
        <title>Create Next App</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/public/img/burger-box-logo.webp" />

      </Head>
      {admin && <AdminNav />}
      {admin &&  <CurrentOrders orders={orders}/>}
     {!admin && <Hero/> }
    {!admin && <Menu sectionsList={sectionsList} itemsList={itemsList} admin={admin}/>}
    </div>
  )
}
export const getServerSideProps = async (ctx) => {
  const myCookie = ctx.req?.cookies || "";
  let admin = false;

   if (myCookie.token === process.env.TOKEN){
    admin = true
   }
  const sectionsRes = await axios.get('http://localhost:3000/api/sections');
  const itemsRes = await axios.get('http://localhost:3000/api/products');
  const res = await axios.get('http://localhost:3000/api/orders');
  return {
    props:{
      sections:sectionsRes.data,
      itemsList: itemsRes.data,
      orders: res.data,
      admin
    }
  }
}